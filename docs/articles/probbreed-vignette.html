<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Probability of Superior Performance • ProbBreed</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Probability of Superior Performance">
<meta property="og:description" content="ProbBreed">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ProbBreed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/probbreed-vignette.html">Probability of Superior Performance</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/saulo-chaves/ProbBreed/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Probability of Superior Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/saulo-chaves/ProbBreed/blob/HEAD/vignettes/probbreed-vignette.Rmd" class="external-link"><code>vignettes/probbreed-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>probbreed-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Welcome to ProbBreed. This guide will help you fitting the Bayesian
model, extracting the outputs and estimating the probabilities of
superior performance, which are used to build the plots. Feel free to
contact us if there are any issues. Further details are found within
each function documentation (e.g., <code><a href="../reference/bayes_met.html">?bayes_met</a></code>) and in the
seminal paper by <a href="https://doi.org/10.1007/s00122-022-04041-y" class="external-link">Dias et
al. (2022)</a>.</p>
</div>
<div class="section level2">
<h2 id="step-one">Step one<a class="anchor" aria-label="anchor" href="#step-one"></a>
</h2>
<p>The first step is to load the <code>ProbBreed</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/saulo-chaves/ProbBreed" class="external-link">ProbBreed</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-two---bayes_met">Step two - <code>bayes_met</code><a class="anchor" aria-label="anchor" href="#step-two---bayes_met"></a>
</h2>
<p>The second step is to fit a multi-environment Bayesian model using
the <code>bayes_met</code> function. This function has a set of
predefined models that are used to run Bayesian analyses using
<code>rstan</code>, the <code>R</code> interface to <code>Stan</code>.
There are some important details that we would like to stress here:</p>
<p><strong>1</strong>- Currently, the function has six options of
models: three models are suitable for considering both information of
local and region (or mega-environment, or any other factor of
higher-level), and the other three models consider only the information
of local (or any factor that you consider an environment). The
difference between these models is the experimental design they are
considering: complete block design (CBD), incomplete block design (IBD),
or no design whatsoever (only-means). After choosing the model that fits
your situation, you must declare the arguments in the function
accordingly (See the figure below):</p>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/desenho.png" style="width:100.0%"></p>
<p>In other words, you have the control of which predefined model you
will use. All you have to do is correctly declare the arguments
<code>reg</code> and <code>repl</code>, since <code>gen</code> and
<code>env</code> will be always present. Note that if you desire to
analyse a data in IBD, <code>repl</code> must be a vector of size two
(i.e., two strings compiled with <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>).</p>
<p><strong>2</strong>- You may change the number of iterations, chains
and cores. This will vary according to the data and the capacity of your
machine. The default is 2000 iterations (including warmup), 1 core and 4
chains. Be aware that the more iterations and chains, the more time the
function will take to provide the results. At the same time, the higher
is the probability of the model to reach more reliable results. The
number of cores depends on the processing capacity of your machine.
Choose wisely.</p>
<p><strong>3</strong>- You can choose between a model with homogeneous
or heterogeneous residual variances using <code>res.het = F</code> and
<code>res.het = T</code>, respectively.</p>
<p>Without further ado, let us see how the six models can be fitted
using <code><a href="../reference/bayes_met.html">bayes_met()</a></code>. The following models are only for
didactic purposes, and will not provide a valid output.</p>
<div class="section level3">
<h3 id="without-region-and-only-means">Without Region and only means<a class="anchor" aria-label="anchor" href="#without-region-and-only-means"></a>
</h3>
<p><span class="math display">\[
y_{jk} = \mu + l_k + g_j + gl_{jk} + \varepsilon_{jk}
\]</span></p>
<p>where the <span class="math inline">\(y_{jk}\)</span> is the
phenotypic record of the <span class="math inline">\(j^{\text{th}}\)</span> genotype in the <span class="math inline">\(k^{\text{th}}\)</span> environment. This
observation is influenced by a grand mean (<span class="math inline">\(\mu\)</span>), the main effects of the <span class="math inline">\(k^{\text{th}}\)</span> environment (<span class="math inline">\(l_k\)</span>) and of the <span class="math inline">\(j^{\text{th}}\)</span> genotype (<span class="math inline">\(g_j\)</span>), the interaction between these two
effects (<span class="math inline">\(gl_{jk}\)</span>), and
non-explained effects (<span class="math inline">\(\varepsilon_{jk}\)</span>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          reg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="without-region-and-randomized-complete-blocks-design">Without Region and randomized complete blocks design<a class="anchor" aria-label="anchor" href="#without-region-and-randomized-complete-blocks-design"></a>
</h3>
<p><span class="math display">\[
y_{jkp} = \mu + l_k + b_{p(k)} + g_j + gl_{jk} + \varepsilon_{jkp}
\]</span></p>
<p>where the <span class="math inline">\(y_{jkp}\)</span> is the
phenotypic record of the <span class="math inline">\(j^{\text{th}}\)</span> genotype, allocated in the
<span class="math inline">\(p^{\text{th}}\)</span> block, in the <span class="math inline">\(k^{\text{th}}\)</span> environment. All other
effects were previously declared but <span class="math inline">\(b_{p(k)}\)</span>, which is the effect of the
<span class="math inline">\(p^{\text{th}}\)</span> block in the <span class="math inline">\(k^{\text{th}}\)</span> environment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="st">"Repetition"</span>,</span>
<span>          reg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="without-region-and-incomplete-blocks-design">Without Region and incomplete blocks design<a class="anchor" aria-label="anchor" href="#without-region-and-incomplete-blocks-design"></a>
</h3>
<p>A lattice, for example:</p>
<p><span class="math display">\[
y_{jkqp} = \mu + l_k + r_{q(k)} + b_{p(qk)} + g_j + gl_{jk} +
\varepsilon_{jkqp}
\]</span></p>
<p>where the <span class="math inline">\(y_{jkqp}\)</span> is the
phenotypic record of the <span class="math inline">\(j^{\text{th}}\)</span> genotype, allocated in the
<span class="math inline">\(p^{\text{th}}\)</span> block of the <span class="math inline">\(q^{\text{th}}\)</span> repetition, in the <span class="math inline">\(k^{\text{th}}\)</span> environment. All other
effects were previously declared but <span class="math inline">\(r_{q(k)}\)</span>, which is the effect of the
<span class="math inline">\(q^{\text{th}}\)</span> repetition in the
<span class="math inline">\(k^{\text{th}}\)</span> environment. Note
that the indices of <span class="math inline">\(b\)</span> also
change.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Repetition"</span>, <span class="st">"Block"</span><span class="op">)</span>,</span>
<span>          reg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="with-region-and-only-means">With Region and only means<a class="anchor" aria-label="anchor" href="#with-region-and-only-means"></a>
</h3>
<p><span class="math display">\[
y_{jkt} = \mu + m_t + l_k + g_j + ge_{jk} + gm_{jk} + \varepsilon_{jkt}
\]</span></p>
<p>All effects were previously declared but <span class="math inline">\(m_t\)</span> and <span class="math inline">\(gm_{jt}\)</span>, which is the main effect of
region and genotype-by-region interaction effect, respectively.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          reg <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="with-region-and-randomized-complete-blocks-design">With Region and randomized complete blocks design<a class="anchor" aria-label="anchor" href="#with-region-and-randomized-complete-blocks-design"></a>
</h3>
<p><span class="math display">\[
y_{jktp} = \mu + m_t + l_k + b_{p(k)} + g_j + gl_{jk} + gm_{jt} +
\varepsilon_{jktp}
\]</span></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="st">"Repetition"</span>,</span>
<span>          reg <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="with-region-and-incomplete-blocks-design">With Region and incomplete blocks design<a class="anchor" aria-label="anchor" href="#with-region-and-incomplete-blocks-design"></a>
</h3>
<p><span class="math display">\[
y_{jktqp} = \mu + m_t + l_k + r_{q(k)} + b_{p(qk)} + g_j + gl_{jk} +
gm_{jt} + \varepsilon_{jktqp}
\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MyData</span>, </span>
<span>          gen <span class="op">=</span> <span class="st">"Genotype"</span>, </span>
<span>          env <span class="op">=</span> <span class="st">"Environment"</span>,</span>
<span>          repl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Repetition"</span>, <span class="st">"Block"</span><span class="op">)</span>,</span>
<span>          reg <span class="op">=</span> <span class="st">"Region"</span>,</span>
<span>          res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          trait <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>          iter <span class="op">=</span> <span class="fl">2000</span>, cores <span class="op">=</span> <span class="fl">1</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> </span></code></pre></div>
<p>For the next steps, we will use the “soy” data, which is contained
within the package. This data set has the adjusted means of 39 genotypes
that were evaluated at 14 environments, in 3 breeding regions.</p>
<pre><code><span><span class="co">#&gt;   Env Reg Gen        Y</span></span>
<span><span class="co">#&gt; 1 E01  R1 G01 49.89367</span></span>
<span><span class="co">#&gt; 2 E01  R1 G02 48.51867</span></span>
<span><span class="co">#&gt; 3 E01  R1 G03 49.81867</span></span>
<span><span class="co">#&gt; 4 E01  R1 G04 47.31867</span></span>
<span><span class="co">#&gt; 5 E01  R1 G05 47.91867</span></span>
<span><span class="co">#&gt; 6 E01  R1 G06 53.01867</span></span></code></pre>
<p>Note that we do not have experimental design in this case, so the
correct model has <code>repl = NULL</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="../reference/bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soy</span>,</span>
<span>                gen <span class="op">=</span> <span class="st">"Gen"</span>,</span>
<span>                env <span class="op">=</span> <span class="st">"Env"</span>,</span>
<span>                repl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                reg <span class="op">=</span> <span class="st">"Reg"</span>,</span>
<span>                res.het <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                trait <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>                iter <span class="op">=</span> <span class="fl">10000</span>, cores <span class="op">=</span> <span class="fl">4</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="step-three---extr_outs">Step three - <code>extr_outs</code><a class="anchor" aria-label="anchor" href="#step-three---extr_outs"></a>
</h2>
<p>After fitting the model, the next step is to extract some useful
outputs. The <code><a href="../reference/extr_outs.html">extr_outs()</a></code> function is a pre-requisite for
estimating the probability of superior performance using the other
functions. <code><a href="../reference/extr_outs.html">extr_outs()</a></code> also provides some important
diagnostics regarding the convergence and reliability of the model.</p>
<p>Using the <code>mod</code> object from the previous step:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span> <span class="op">=</span> <span class="fu"><a href="../reference/extr_outs.html">extr_outs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soy</span>, trait <span class="op">=</span> <span class="st">'Y'</span>, gen <span class="op">=</span> <span class="st">'Gen'</span>, model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>                 effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'l'</span>,<span class="st">'g'</span>,<span class="st">'gl'</span>,<span class="st">'m'</span>,<span class="st">'gm'</span><span class="op">)</span>,</span>
<span>                 nenv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">soy</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 res.het <span class="op">=</span> <span class="cn">F</span>, </span>
<span>                 probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>, check.stan.diag <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>In this function structure:</p>
<ul>
<li><p><code>model</code> is the model fitted using
<code>bayes_met</code></p></li>
<li>
<p><code>effects</code> indicates which effects <code>model</code>
has. Here, you may provide a string vector with the codes for each
possible effect. The codes are:</p>
<ul>
<li><p><code>r</code> : replicate effect</p></li>
<li><p><code>b</code> : block effect</p></li>
<li><p><code>l</code> : environment (or location) effect</p></li>
<li><p><code>m</code> : region effect</p></li>
<li><p><code>g</code> : genetic effect</p></li>
<li><p><code>gl</code> : genotype-by-location effect</p></li>
<li><p><code>gm</code> : genotype-by-region effect</p></li>
</ul>
</li>
</ul>
<p>The models will surely have <code>r</code>, <code>l</code>,
<code>g</code> and <code>gl</code>. The other effects may or may not be
necessary, depending on the situation.</p>
<ul>
<li><p><code>nenv</code> indicates the number of environments</p></li>
<li><p><code>probs</code> are the probabilities that the function will
consider to calculate the quantiles and the HPD (please, provide values
between 0 and 1)</p></li>
<li><p><code>check.stan.diag</code> asks whether you want diagnostic
plots provided by <code><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">rstan::stan_diag()</a></code> or not.</p></li>
</ul>
<p>The function provides a list with the posterior of each effect, the
data generated by the model, a data frame with the variances of each
effect, a list with the maximum posterior values of each effect, and a
matrix containing some useful quality parameters of the model (See
below):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span><span class="op">$</span><span class="va">variances</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   effect          var           sd     naive.se     HPD_0.05     HPD_0.95</span></span>
<span><span class="co">#&gt; 1      l 2.564572e+02 1.463334e+02 1.034733e+00 1.169418e+02 5.112287e+02</span></span>
<span><span class="co">#&gt; 2      g 3.359095e+00 1.390223e+00 9.830360e-03 1.429297e+00 5.915535e+00</span></span>
<span><span class="co">#&gt; 3     gl 8.243217e+00 5.089885e+00 3.599092e-02 5.886441e-01 1.592978e+01</span></span>
<span><span class="co">#&gt; 4      m 1.467906e+04 5.924323e+05 4.189129e+03 9.811128e-01 1.187435e+04</span></span>
<span><span class="co">#&gt; 5     gm 9.232269e-01 1.040238e+00 7.355591e-03 2.939105e-04 2.967420e+00</span></span>
<span><span class="co">#&gt; 6    res 3.886437e+05 4.745138e+06 3.355319e+04 6.076304e+00 1.020981e+06</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span><span class="op">$</span><span class="va">ppcheck</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              Diagnostics</span></span>
<span><span class="co">#&gt; p.val_max         0.9634</span></span>
<span><span class="co">#&gt; p.val_min         0.2800</span></span>
<span><span class="co">#&gt; p.val_median      0.6458</span></span>
<span><span class="co">#&gt; p.val_mean        0.4896</span></span>
<span><span class="co">#&gt; p.val_sd          0.5138</span></span>
<span><span class="co">#&gt; Eff_Npar        133.2275</span></span>
<span><span class="co">#&gt; WAIC2          2512.2289</span></span>
<span><span class="co">#&gt; mean_Rhat         1.0314</span></span></code></pre>
<p>It also provides a list containing built-in histograms, density plots
and trace plots of each effect. For example, the density plot comparing
the generated data by each chain and the real data…</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span><span class="op">$</span><span class="va">fun_plots</span><span class="op">$</span><span class="va">densities</span><span class="op">$</span><span class="va">sampled_y</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/density.png" style="width:100.0%"></p>
<p>…Or the histogram of the genetic main effects:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span><span class="op">$</span><span class="va">fun_plots</span><span class="op">$</span><span class="va">histogram</span><span class="op">$</span><span class="va">g</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/histogram.png" style="width:100.0%"></p>
<p>These plots are available for all effects declared in
<code><a href="../reference/extr_outs.html">extr_outs()</a></code>. Feel free to explore it. As an option, the
function also provides some diagnostic plots of
<code><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">rstan::stan_diag()</a></code>. The <code>...</code> is passed to
<code><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">rstan::stan_diag()</a></code>, so you can explore further options
provided by the function. For more information about these plots, please
refer to <code><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">?rstan::stan_diag</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outs</span> <span class="op">=</span> <span class="fu"><a href="../reference/extr_outs.html">extr_outs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soy</span>, trait <span class="op">=</span> <span class="st">'Y'</span>, gen <span class="op">=</span> <span class="st">'Gen'</span>, model <span class="op">=</span> <span class="va">mod</span>,</span>
<span>                 effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'l'</span>,<span class="st">'g'</span>,<span class="st">'gl'</span>,<span class="st">'m'</span>,<span class="st">'gm'</span><span class="op">)</span>,</span>
<span>                 nenv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">soy</span><span class="op">$</span><span class="va">Env</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 res.het <span class="op">=</span> <span class="cn">F</span>, check.stan.diag <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/stanplots.png" style="width:100.0%"></p>
</div>
<div class="section level2">
<h2 id="step-four---prob_sup">Step four - <code>prob_sup</code><a class="anchor" aria-label="anchor" href="#step-four---prob_sup"></a>
</h2>
<p>Using the outputs extracted by <code><a href="../reference/extr_outs.html">extr_outs()</a></code>, we can
finally calculate the probability of superior performance and superior
stability of the evaluated genotypes. This is exactly what
<code><a href="../reference/prob_sup.html">prob_sup()</a></code> will do:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">=</span> <span class="fu"><a href="../reference/prob_sup.html">prob_sup</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soy</span>, trait <span class="op">=</span> <span class="st">"Y"</span>, gen <span class="op">=</span> <span class="st">"Gen"</span>, env <span class="op">=</span> <span class="st">"Env"</span>,</span>
<span>                   extr_outs <span class="op">=</span> <span class="va">outs</span>, reg <span class="op">=</span> <span class="st">'Reg'</span>, int <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>                   increase <span class="op">=</span> <span class="cn">T</span>, save.df <span class="op">=</span> <span class="cn">F</span>, interactive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><code>data</code>, <code>trait</code>, <code>gen</code>,
<code>env</code> and <code>reg</code> were previously described. The new
commands of this function are:</p>
<ul>
<li><p><code>increase</code>: The selection is for increasing
(<code>TRUE</code>, default) or decreasing (<code>FALSE</code>) the
trait mean?</p></li>
<li><p><code>extr_outs</code>: An object that contains the outputs
extracted by <code><a href="../reference/extr_outs.html">extr_outs()</a></code>.</p></li>
<li><p><code>int</code>: The selection intensity, expressed in decimal
values.</p></li>
<li><p><code>save.df</code>: <code>TRUE</code> if you want to save the
data frames containing the calculated probabilities in the work
directory, <code>FALSE</code> otherwise.</p></li>
<li><p><code>interactive</code>: <code>TRUE</code> if you want to
convert the ggplots into ggplotlys, i.e. make them interactive plots,
<code>FALSE</code> otherwise.</p></li>
</ul>
<p>The outputs of this function are divided into two lists:
<code>marginal</code> and <code>conditional</code>. The first list
contains the probabilities of superior performance and superior
stability across environments, whilst the second contains the
probabilities of superior performance within environments. Both lists
have the pairwise probabilities of both superior performance and
stability, for comparison purposes.</p>
<div class="section level3">
<h3 id="marginal-output">Marginal output<a class="anchor" aria-label="anchor" href="#marginal-output"></a>
</h3>
<p>The <code>marginal</code> list contains two other lists: one with
data frames detailing the results of each computed probability, and
another with ggplots illustrating the computed probabilities. Below, we
detail each result:</p>
<div class="section level4">
<h4 id="high-posterior-density-of-genetic-main-effects">High posterior density of genetic main effects<a class="anchor" aria-label="anchor" href="#high-posterior-density-of-genetic-main-effects"></a>
</h4>
<p>This metric is illustrated in a caterpillar plot:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">g_hpd</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/hpd.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="probability-of-superior-performance">Probability of superior performance<a class="anchor" aria-label="anchor" href="#probability-of-superior-performance"></a>
</h4>
<p>Let <span class="math inline">\(\Omega\)</span> represent the subset
of selected genotypes based on their performance across environments. A
given genotype <span class="math inline">\(j\)</span> will belong to
<span class="math inline">\(\Omega\)</span> if its genetic marginal
value (<span class="math inline">\(g_j\)</span>) is among the top <span class="math inline">\(V\)</span>, with <span class="math inline">\(V\)</span> being the selection intensity.
<code><a href="../reference/prob_sup.html">prob_sup()</a></code> leverages the Monte Carlo discretized sampling
from the posterior distribution to emulate the occurrence of <span class="math inline">\(S\)</span> trials. Thence, the probability of the
<span class="math inline">\(j^{\text{th}}\)</span> genotype belonging to
<span class="math inline">\(\Omega\)</span> is the ratio of success
(<span class="math inline">\(g_j \in \Omega\)</span>) and the total
number of sampled events (the emulated <span class="math inline">\(S\)</span> trials):</p>
<p><span class="math display">\[
Pr(g_j \in \Omega \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_j^{(s)} \in
\Omega \vert y)}
\]</span> where <span class="math inline">\(S\)</span> is the total
number of samples (<span class="math inline">\(s = 1, 2, \dots,
S\)</span>), and <span class="math inline">\(I(g_j^{(s)} \in \Omega
\vert y)\)</span> is an indicator variable mapping success (1) if <span class="math inline">\(g_j^{(s)}\)</span> exists in <span class="math inline">\(\Omega\)</span> in the <span class="math inline">\(s^{\text{th}}\)</span> sample, and failure (0)
otherwise. <span class="math inline">\(S\)</span> is conditioned to the
number of iterations and chains previously set at
<code><a href="../reference/bayes_met.html">bayes_met()</a></code>.</p>
<p>The results provided by <code><a href="../reference/prob_sup.html">prob_sup()</a></code> can be accessed using
the following commands:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">perfo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     ID    prob</span></span>
<span><span class="co">#&gt; 36 G36 0.94545</span></span>
<span><span class="co">#&gt; 31 G31 0.82250</span></span>
<span><span class="co">#&gt; 20 G20 0.79905</span></span>
<span><span class="co">#&gt; 9  G09 0.66595</span></span>
<span><span class="co">#&gt; 38 G38 0.59905</span></span>
<span><span class="co">#&gt; 1  G01 0.54605</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">perfo</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/margs.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="pairwise-probability-of-superior-performance">Pairwise probability of superior performance<a class="anchor" aria-label="anchor" href="#pairwise-probability-of-superior-performance"></a>
</h4>
<p>To directly compare a selection candidate with a commercial check, or
another promising genotype, we can calculate the pairwise probability of
superior performance. This metric computes the probability of a genotype
<span class="math inline">\(j\)</span> performing better than a genotype
<span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
Pr(g_j &gt; g_i \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_j^{(s)} &gt;
g_i^{(s)} \vert y)}
\]</span> where <span class="math inline">\(I(g_j^{(s)} &gt; g_i^{(s)}
\vert y)\)</span> is an indicator variable mapping if <span class="math inline">\(g_j\)</span> is better (1) than <span class="math inline">\(g_i\)</span>, or not (0). Note that this equation
is applied if the selection direction is to increase the trait value. If
the aim is to decrease it (for example, plant height or the damage of a
disease), you can set <code>increase = F</code>, and the following
equation is employed:</p>
<p><span class="math display">\[
Pr(g_j &lt; g_i \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_j^{(s)} &lt;
g_i^{(s)} \vert y)}
\]</span> The results are accessed using the following commands:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">pair_perfo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     x    prob   y</span></span>
<span><span class="co">#&gt; 2 G01 0.97360 G02</span></span>
<span><span class="co">#&gt; 3 G01 0.77295 G03</span></span>
<span><span class="co">#&gt; 4 G01 0.95590 G04</span></span>
<span><span class="co">#&gt; 5 G01 0.99120 G05</span></span>
<span><span class="co">#&gt; 6 G01 0.74290 G06</span></span>
<span><span class="co">#&gt; 7 G01 0.74170 G07</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">pair_perfo</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/pwprob_marg.png" style="width:100.0%"></p>
<p>The results indicates the probability of genotypes at the
<em>x</em>-axis performing superiorly in relation to those at the
<em>y</em>-axis.</p>
</div>
<div class="section level4">
<h4 id="probability-of-superior-stability">Probability of superior stability<a class="anchor" aria-label="anchor" href="#probability-of-superior-stability"></a>
</h4>
<p>Another criterion for recommending candidates to a target population
of environments is by assessing how variable is their performance across
environments. If we consider genotypes that have low
genotype-by-environment interaction variance [<span class="math inline">\(var(ge_{jk})\)</span>] as stable, the probability
of superior stability is given by the following equation:</p>
<p><span class="math display">\[
Pr[var(ge_{jk}) \in \Omega \vert y] = \frac{1}{S}
\sum_{s=1}^S{I[var(ge_{jk}) \in \Omega \vert y]}
\]</span> where <span class="math inline">\(I[var(ge_{jk}) \in \Omega
\vert y]\)</span> is an indicator variable mapping success (1) if the
<span class="math inline">\(j^{\text {th}}\)</span> has one of the <span class="math inline">\(V\)</span> lower variances of the
genotype-by-environment interaction, and failure (0) otherwise.</p>
<p>If <code>reg</code> is not <code>NULL</code>, like in the example,
two probabilities are computed separately, one for the
genotype-by-environment interaction (<code>stabi_gl</code>), and another
for the genotype-by-region interaction (<code>stabi_gm</code>).
Otherwise, if <code>reg = NULL</code>, only <code>stabi_gl</code> will
be available. For the example we are running, the results are accessed
using the following commands:</p>
<ul>
<li>Genotype-by-environment interaction</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">stabi_gl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     ID    prob</span></span>
<span><span class="co">#&gt; 23 G23 0.47675</span></span>
<span><span class="co">#&gt; 34 G34 0.43345</span></span>
<span><span class="co">#&gt; 35 G35 0.38025</span></span>
<span><span class="co">#&gt; 8  G08 0.30390</span></span>
<span><span class="co">#&gt; 27 G27 0.30015</span></span>
<span><span class="co">#&gt; 13 G13 0.29990</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">stabi_gl</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/stabi_gl.png" style="width:100.0%"></p>
<ul>
<li>Genotype-by-region interaction</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">stabi_gm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     ID    prob</span></span>
<span><span class="co">#&gt; 15 G15 0.23735</span></span>
<span><span class="co">#&gt; 32 G32 0.23725</span></span>
<span><span class="co">#&gt; 34 G34 0.23690</span></span>
<span><span class="co">#&gt; 16 G16 0.23250</span></span>
<span><span class="co">#&gt; 1  G01 0.23210</span></span>
<span><span class="co">#&gt; 23 G23 0.23175</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">stabi_gm</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/stabi_gm.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="pairwise-probability-of-superior-stability">Pairwise probability of superior stability<a class="anchor" aria-label="anchor" href="#pairwise-probability-of-superior-stability"></a>
</h4>
<p>We can also compare the stability of two selection candidates, or a
experimental genotype and a commercial check. The following equation is
used:</p>
<p><span class="math display">\[
Pr[var(ge_{jk}) &lt; var(ge_{ik}) \vert y] = \frac{1}{S} \sum_{s=1}^S{I
[var(ge_{jk}^{(s)}) &lt; var(ge_{ik}^{(s)}) \vert y]}
\]</span> note that, in this case, we are always interested in the
genotype that has a lower variance of the genotype-by-environment (or
genotype-by-region) interaction effects.</p>
<p>Again, there will be two different results when <code>reg</code> is
not <code>NULL</code> (see below). When <code>reg = NULL</code>, only
<code>pair_stabi_gl</code> is available. The following commands are used
to access the results:</p>
<ul>
<li>Genotype-by-environment interaction</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">pair_stabi_gl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     x    prob   y</span></span>
<span><span class="co">#&gt; 2 G01 0.55415 G02</span></span>
<span><span class="co">#&gt; 3 G01 0.48535 G03</span></span>
<span><span class="co">#&gt; 4 G01 0.52830 G04</span></span>
<span><span class="co">#&gt; 5 G01 0.62005 G05</span></span>
<span><span class="co">#&gt; 6 G01 0.51410 G06</span></span>
<span><span class="co">#&gt; 7 G01 0.44720 G07</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">pair_stabi_gl</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/pair_stabi_gl.png" style="width:100.0%"></p>
<p>The results indicates the probability of genotypes at the
<em>x</em>-axis being more stable than the genotype at the
<em>y</em>-axis.</p>
<ul>
<li>Genotype-by-region interaction</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">pair_stabi_gm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     x    prob   y</span></span>
<span><span class="co">#&gt; 2 G01 0.59370 G02</span></span>
<span><span class="co">#&gt; 3 G01 0.51150 G03</span></span>
<span><span class="co">#&gt; 4 G01 0.52400 G04</span></span>
<span><span class="co">#&gt; 5 G01 0.56620 G05</span></span>
<span><span class="co">#&gt; 6 G01 0.54615 G06</span></span>
<span><span class="co">#&gt; 7 G01 0.50260 G07</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">pair_stabi_gm</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/pair_stabi_gm.png" style="width:100.0%"></p>
<p>The results indicates the probability of genotypes at the
<em>x</em>-axis being more stable than the genotype at the
<em>y</em>-axis.</p>
</div>
<div class="section level4">
<h4 id="joint-probability-of-superior-performance-and-superior-stability">Joint probability of superior performance and superior
stability<a class="anchor" aria-label="anchor" href="#joint-probability-of-superior-performance-and-superior-stability"></a>
</h4>
<p>Assuming that these the genetic main effects are independent of the
variance of the genotype-by-environment interaction effects, the joint
probability of superior performance and superior stability follows the
same ideia as the probability of occurrence of two independent
events:</p>
<p><span class="math display">\[
Pr[g_j \in \Omega, var(ge_{jk} \in \Omega)] = Pr(g_j \in \Omega \vert y)
\times Pr[var(ge_{jk}) \in \Omega \vert y]
\]</span></p>
<p>The results are accessed using the following commands:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">joint_prob</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      ID    level category         prob</span></span>
<span><span class="co">#&gt; 157 G01 Location    Joint 0.1102474950</span></span>
<span><span class="co">#&gt; 158 G02 Location    Joint 0.0010212300</span></span>
<span><span class="co">#&gt; 159 G03 Location    Joint 0.0446639700</span></span>
<span><span class="co">#&gt; 160 G04 Location    Joint 0.0028105000</span></span>
<span><span class="co">#&gt; 161 G05 Location    Joint 0.0001216475</span></span>
<span><span class="co">#&gt; 162 G06 Location    Joint 0.0447423700</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">joint_prob</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/joint.png" style="width:100.0%"></p>
<p>If <code>reg = NULL</code>, there will be no differentiation between
environments and region in the plot above.</p>
</div>
</div>
<div class="section level3">
<h3 id="conditional-output">Conditional output<a class="anchor" aria-label="anchor" href="#conditional-output"></a>
</h3>
<p>The probabilities of superior performance can be particularized for
each environment. In other words, if you want to recommend an
experimental genotype for a specific location, for example, these are
the results you are looking for. The <code>conditional</code> list is
also divided into two sublists. The first, <code>df</code>, contains the
results compiled into data frames. The second, <code>plots</code>, have
the corresponding ggplots.</p>
<div class="section level4">
<h4 id="probability-of-superior-performance-1">Probability of superior performance<a class="anchor" aria-label="anchor" href="#probability-of-superior-performance-1"></a>
</h4>
<p>It is exactly the same idea as previous stated, but instead of using
the marginal genetic effect of each genotype, we use the conditional
genetic effect (<span class="math inline">\(g_{jk} = g_j +
ge_{jk}\)</span>):</p>
<p><span class="math display">\[
Pr(g_{jk} \in \Omega_k \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_{jk}^{(s)}
\in \Omega_k \vert y)}
\]</span></p>
<p>The results are accessed using the following commands:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">perfo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   env reg gen    prob</span></span>
<span><span class="co">#&gt; 1 E01  R1 G01 0.17765</span></span>
<span><span class="co">#&gt; 2 E01  R1 G02 0.01025</span></span>
<span><span class="co">#&gt; 3 E01  R1 G03 0.09220</span></span>
<span><span class="co">#&gt; 4 E01  R1 G04 0.01265</span></span>
<span><span class="co">#&gt; 5 E01  R1 G05 0.00360</span></span>
<span><span class="co">#&gt; 6 E01  R1 G06 0.19790</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">perfo_env</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/cond_perfo.png" style="width:100.0%"></p>
<p>The grey cells are environments in which the genotype specified in
the row was not evaluated.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">perfo_reg</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/cond_perfo_reg.png" style="width:100.0%"></p>
<p>This plot is only available if <code>reg</code> is not
<code>NULL</code>.</p>
</div>
<div class="section level4">
<h4 id="pairwise-probability-of-superior-performance-1">Pairwise probability of superior performance<a class="anchor" aria-label="anchor" href="#pairwise-probability-of-superior-performance-1"></a>
</h4>
<p>A directly comparison between genotypes evaluated at the same
environment. <code><a href="../reference/prob_sup.html">prob_sup()</a></code> used the following equations:</p>
<ul>
<li>When <code>increase = TRUE</code>
</li>
</ul>
<p><span class="math display">\[
Pr(g_{jk} &gt; g_{ik} \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_{jk}^{(s)}
&gt; g_{ik}^{(s)} \vert y)}
\]</span></p>
<ul>
<li>When <code>increase = FALSE</code>
</li>
</ul>
<p><span class="math display">\[
Pr(g_{jk} &lt; g_{ik} \vert y) = \frac{1}{S}\sum_{s=1}^S{I(g_{jk}^{(s)}
&lt; g_{ik}^{(s)} \vert y)}
\]</span></p>
<p>Note that this result could not be compiled into a single data frame,
since there will be a pairwise comparison for each environment.
Therefore, we opt to build several data frames and store them in a list
(<code>pair_perfo_env</code>). When <code>reg</code> is not
<code>NULL</code>, there will also be a second list,
<code>pair_perfo_reg</code>. The ggplots are also stored in lists.
Therefore, the results are accessed using the following commands, taking
the environment “E05” and the region “R2” as examples:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">pair_perfo_env</span><span class="op">$</span><span class="va">E05</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     y   x  pwprob</span></span>
<span><span class="co">#&gt; 1 G02 G01 0.95790</span></span>
<span><span class="co">#&gt; 2 G03 G01 0.34910</span></span>
<span><span class="co">#&gt; 3 G03 G02 0.03285</span></span>
<span><span class="co">#&gt; 4 G04 G01 0.95620</span></span>
<span><span class="co">#&gt; 5 G04 G03 0.96010</span></span>
<span><span class="co">#&gt; 6 G04 G02 0.51755</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">pair_perfo_env</span><span class="op">$</span><span class="va">E05</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/E05.png" style="width:100.0%"></p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">df</span><span class="op">$</span><span class="va">pair_perfo_reg</span><span class="op">$</span><span class="va">R2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     y   x     pwprob</span></span>
<span><span class="co">#&gt; 1 G02 G01 0.96788333</span></span>
<span><span class="co">#&gt; 2 G03 G01 0.60066667</span></span>
<span><span class="co">#&gt; 3 G03 G02 0.09798333</span></span>
<span><span class="co">#&gt; 4 G04 G01 0.95316667</span></span>
<span><span class="co">#&gt; 5 G04 G03 0.86826667</span></span>
<span><span class="co">#&gt; 6 G04 G02 0.36655000</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">plots</span><span class="op">$</span><span class="va">pair_perfo_reg</span><span class="op">$</span><span class="va">R2</span></span></code></pre></div>
<p><img src="../../../../../Meu%20Drive/Projetos/Probability_GEI/ProbBreed/articles/img/R2.png" style="width:100.0%"></p>
<p>Like the other heat maps, we are evaluating the probability of
genotypes at <em>x</em>-axis being superior than genotypes at the
<em>y</em>-axis.</p>
<p>Note that the estimation of these probabilities are strictly related
to some key question that constantly arises in plant breeding:</p>
<ul>
<li><p><strong>What is the risk of recommending a selection candidate
for a target population of environments?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate
having good performance if recommended to a target population of
environments? And for a specific environment?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate
having better performance than a cultivar check in the target population
of environments? And in specific environments?</strong></p></li>
<li><p><strong>How probable is it that a given selection candidate
performs similarly across environments?</strong></p></li>
<li><p><strong>What are the chances that a given selection candidate is
more stable than a cultivar check in the target population of
environments?</strong></p></li>
<li><p><strong>What is the probability that a given selection candidate
having a superior and invariable performance across
environments?</strong></p></li>
</ul>
<p>We hope this package is useful for you to answer any of these
questions. Feel free to contact us if there any issues or suggestions
for improvement.</p>
<p><br></p>
<p><br></p>
<p><strong>FIM</strong></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Saulo Chaves, Kaio Dias, Matheus Krause.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
