<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Probabilities of superior performance and stability — prob_sup • ProbBreed</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Probabilities of superior performance and stability — prob_sup"><meta property="og:description" content="This function estimates the probabilities of superior performance and stability
across environments, and probabilities of superior performance within environments."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ProbBreed</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/saulo-chaves/ProbBreed/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Probabilities of superior performance and stability</h1>
    <small class="dont-index">Source: <a href="https://github.com/saulo-chaves/ProbBreed/blob/HEAD/R/prob_sup.R" class="external-link"><code>R/prob_sup.R</code></a></small>
    <div class="hidden name"><code>prob_sup.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function estimates the probabilities of superior performance and stability
across environments, and probabilities of superior performance within environments.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">prob_sup</span><span class="op">(</span><span class="va">extr</span>, <span class="va">int</span>, increase <span class="op">=</span> <span class="cn">TRUE</span>, save.df <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-extr">extr<a class="anchor" aria-label="anchor" href="#arg-extr"></a></dt>
<dd><p>An object of class <code>extr</code>, obtained from the <a href="extr_outs.html">extr_outs</a> function</p></dd>


<dt id="arg-int">int<a class="anchor" aria-label="anchor" href="#arg-int"></a></dt>
<dd><p>A numeric representing the selection intensity
(between 0 and 1)</p></dd>


<dt id="arg-increase">increase<a class="anchor" aria-label="anchor" href="#arg-increase"></a></dt>
<dd><p>Logical.<code>TRUE</code> (default) if the selection is for increasing the trait value, <code>FALSE</code> otherwise.</p></dd>


<dt id="arg-save-df">save.df<a class="anchor" aria-label="anchor" href="#arg-save-df"></a></dt>
<dd><p>Logical. Should the data frames be saved in the work directory?
<code>TRUE</code> for saving, <code>FALSE</code> (default) otherwise.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical value. If <code>TRUE</code>, the function will indicate the
completed steps. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The function returns an object of class <code>probsup</code>, which contains two lists,
one with the <code>across</code>-environments probabilities, and another with the <code>within</code>-environments probabilities.</p>
<p>The <code>across</code> list has the following elements:</p><ul><li><p><code>g_hpd</code>: Highest posterior density (HPD) of the posterior genotypic main effects.</p></li>
<li><p><code>perfo</code>: the probabilities of superior performance.</p></li>
<li><p><code>pair_perfo</code>: the pairwise probabilities of superior performance.</p></li>
<li><p><code>stabi</code>: a list with the probabilities of superior stability. It contains the data frames <code>gl</code>,
<code>gm</code> (when <code>reg</code> is not <code>NULL</code>) and <code>gt</code> (when <code>year</code> is not <code>NULL</code>).</p></li>
<li><p><code>pair_stabi</code>: a list with the pairwise probabilities of superior stability. It contains the data frames <code>gl</code>,
<code>gm</code> (when <code>reg</code> is not <code>NULL</code>) and <code>gt</code> (when <code>year</code> is not <code>NULL</code>).</p></li>
<li><p><code>joint_prob</code>: the joint probabilities of superior performance and stability.</p></li>
</ul><p>The <code>within</code> list has the following elements:</p><ul><li><p><code>perfo</code>: a list of data frames containing the probabilities of superior performance
within locations (<code>gl</code>), regions (<code>gm</code>) and years (<code>gt</code>).</p></li>
<li><p><code>pair_perfo</code>: lists with the pairwise probabilities of superior performance
within locations (<code>gl</code>), regions (<code>gm</code>) and years (<code>gt</code>).</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Probabilities provide the risk of recommending a selection candidate for a target
population of environments or for a specific environment. <code>prob_sup</code>
computes the probabilities of superior performance and the probabilities of superior stability:</p>
<ul><li><p>Probability of superior performance</p></li>
</ul><p>Let \(\Omega\) represent the subset of selected genotypes based on their
performance across environments. A given genotype \(j\) will belong to \(\Omega\)
if its genotypic marginal value (\(\hat{g}_j\)) is high or low enough compared to
its peers. <code>prob_sup</code> leverages the Monte Carlo discretized sampling
from the posterior distribution to emulate the occurrence of \(S\) trials. Then,
the probability of the \(j^{th}\) genotype belonging to \(\Omega\) is the
ratio of success (\(\hat{g}_j \in \Omega\)) events and the total number of sampled events,
as follows:</p>
<p>$$Pr\left(\hat{g}_j \in \Omega \vert y \right) = \frac{1}{S}\sum_{s=1}^S{I\left(\hat{g}_j^{(s)} \in \Omega \vert y\right)}$$</p>
<p>where \(S\) is the total number of samples \(\left(s = 1, 2, ..., S \right)\),
and \(I\left(g_j^{(s)} \in \Omega \vert y\right)\) is an indicator variable that can assume
two values: (1) if \(\hat{g}_j^{(s)} \in \Omega\) in the \(s^{th}\) sample,
and (0) otherwise. \(S\) is conditioned to the number of iterations and chains
previously set at <a href="bayes_met.html">bayes_met</a>.</p>
<p>Similarly, the within-environment probability of superior performance can be applied to
individual environments. Let \(\Omega_k\) represent the subset of superior
genotypes in the \(k^{th}\) environment, so that the probability of the
\(j^{th} \in \Omega_k\) can calculated as follows:</p>
<p>$$Pr\left(\hat{g}_{jk} \in \Omega_k \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y\right)$$</p>
<p>where \(I\left(\hat{g}_{jk}^{(s)} \in \Omega_k \vert y\right)\) is an indicator variable
mapping success (1) if \(\hat{g}_{jk}^{(s)}\) exists in \(\Omega_k\), and
failure (0) otherwise, and \(\hat{g}_{jk}^{(s)} = \hat{g}_j^{(s)} + \widehat{ge}_{jk}^{(s)}\).
Note that when computing within-environment probabilities, we are accounting for
the interaction of the \(j^{th}\) genotype with the \(k^{th}\)
environment.</p>
<p>The pairwise probabilities of superior performance can also be calculated across
or within environments. This metric assesses the probability of the \(j^{th}\)
genotype being superior to another experimental genotype or a commercial check.
The calculations are as follows, across and within environments, respectively:</p>
<p>$$Pr\left(\hat{g}_{j} &gt; \hat{g}_{j^\prime} \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{j}^{(s)} &gt; \hat{g}_{j^\prime}^{(s)} \vert y\right)$$</p>
<p>or</p>
<p>$$Pr\left(\hat{g}_{jk} &gt; \hat{g}_{j^\prime k} \vert y\right) = \frac{1}{S} \sum_{s=1}^S I\left(\hat{g}_{jk}^{(s)} &gt; \hat{g}_{j^\prime k}^{(s)} \vert y\right)$$</p>
<p>These equations are set for when the selection direction is positive. If
<code>increase = FALSE</code>, \(&gt;\) is simply switched by \(&lt;\).</p>
<ul><li><p>Probability of superior stability</p></li>
</ul><p>This probability makes a direct analogy with the
method of Shukla (1972): a stable genotype is the one that has a low
genotype-by-environment interaction variance \([var(\widehat{ge})]\).
Using the same probability principles previously described, the probability
of superior stability is given as follows:</p>
<p>$$Pr \left[var \left(\widehat{ge}_{jk}\right) \in \Omega \vert y \right] = \frac{1}{S} \sum_{s=1}^S I\left[var \left(\widehat{ge}_{jk}^{(s)} \right) \in \Omega \vert y \right]$$</p>
<p>where \(I\left[var \left(\widehat{ge}_{jk}^{(s)} \right) \in \Omega \vert y \right]\) indicates if
\(var\left(\widehat{ge}_{jk}^{(s)}\right)\) exists in \(\Omega\) (1) or not (0).
Pairwise probabilities of superior stability are also possible in this context:</p>
<p>$$Pr \left[var \left(\widehat{ge}_{jk} \right) &lt; var\left(\widehat{ge}_{j^\prime k} \right) \vert y \right] = \frac{1}{S} \sum_{s=1}^S I \left[var \left(\widehat{ge}_{jk} \right)^{(s)} &lt; var \left(\widehat{ge}_{j^\prime k} \right)^{(s)} \vert y \right]$$</p>
<p>Note that \(j\) will be superior to \(j^\prime\) if it has a <strong>lower</strong>
variance of the genotype-by-environment interaction effect. This is true regardless
if <code>increase</code> is set to <code>TRUE</code> or <code>FALSE</code>.</p>
<p>The joint probability independent events is the product of the individual probabilities.
The estimated genotypic main effects and the variances of GEI effects are independent
by design, thus the joint probability of superior performance and stability as follows:</p>
<p>$$Pr \left[\hat{g}_j \in \Omega \cap var \left(\widehat{ge}_{jk} \right) \in \Omega \right] = Pr \left(\hat{g}_j \in \Omega \right) \times Pr \left[var \left(\widehat{ge}_{jk} \right) \in \Omega \right]$$</p>
<p>The estimation of these probabilities are strictly related to some key questions that
constantly arises in plant breeding:</p><ul><li><p><strong>What is the risk of recommending a selection candidate for a target population of environments?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate having good performance if
recommended to a target population of environments? And for a specific environment?</strong></p></li>
<li><p><strong>What is the probability of a given selection candidate having better performance
than a cultivar check in the target population of environments? And in specific environments?</strong></p></li>
<li><p><strong>How probable is it that a given selection candidate performs similarly across environments?</strong></p></li>
<li><p><strong>What are the chances that a given selection candidate is more stable
than a cultivar check in the target population of environments?</strong></p></li>
<li><p><strong>What is the probability that a given selection candidate having a
superior and invariable performance across environments?</strong></p></li>
</ul><p>More details about the usage of <code>prob_sup</code>, as well as the other function of
the <code>ProbBreed</code> package can be found at <a href="https://saulo-chaves.github.io/ProbBreed_site/" class="external-link">https://saulo-chaves.github.io/ProbBreed_site/</a>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Dias, K. O. G, Santos J. P. R., Krause, M. D., Piepho H. -P., Guimarães, L. J. M.,
Pastina, M. M., and Garcia, A. A. F. (2022). Leveraging probability concepts
for cultivar recommendation in multi-environment trials. <em>Theoretical and
Applied Genetics</em>, 133(2):443-455. <a href="https://doi.org/10.1007/s00122-022-04041-y" class="external-link">doi:10.1007/s00122-022-04041-y</a></p>
<p>Shukla, G. K. (1972) Some statistical aspects of partioning genotype environmental
componentes of variability. <em>Heredity</em>, 29:237-245. <a href="https://doi.org/10.1038/hdy.1972.87" class="external-link">doi:10.1038/hdy.1972.87</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="plot.probsup.html">plot.probsup</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">=</span> <span class="fu"><a href="bayes_met.html">bayes_met</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">soy</span>,</span></span>
<span class="r-in"><span>                gen <span class="op">=</span> <span class="st">"Gen"</span>,</span></span>
<span class="r-in"><span>                loc <span class="op">=</span> <span class="st">"Loc"</span>,</span></span>
<span class="r-in"><span>                repl <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                year <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                reg <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>                res.het <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                trait <span class="op">=</span> <span class="st">'Y'</span>,</span></span>
<span class="r-in"><span>                iter <span class="op">=</span> <span class="fl">6000</span>, cores <span class="op">=</span> <span class="fl">4</span>, chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">outs</span> <span class="op">=</span> <span class="fu"><a href="extr_outs.html">extr_outs</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>,</span></span>
<span class="r-in"><span>                 probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Posterior effects extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Variances extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Maximum posterior values extracted</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -&gt; Posterior predictive checks computed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Divergences:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 of 12000 iterations ended with a divergence.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tree depth:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 0 of 12000 iterations saturated the maximum tree depth of 10.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Energy:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> E-BFMI indicated no pathological behavior.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">=</span> <span class="fu">prob_sup</span><span class="op">(</span>extr <span class="op">=</span> <span class="va">outs</span>,</span></span>
<span class="r-in"><span>                   int <span class="op">=</span> <span class="fl">.2</span>,</span></span>
<span class="r-in"><span>                   increase <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                   save.df <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                   verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Saulo Chaves, Kaio Dias, Matheus Krause.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer></div>






  </body></html>

